"0","xmlFile <- ""Books-v4.xml"""
"0","pathToFile <- paste0(cwd, .Platform$file.sep, xmlFile)"
"0","parsedXML <- xmlParse(pathToFile, trim = T)"
"0","root <- xmlRoot(parsedXML)"
"0","sizeOfXML <- xmlSize(root)"
"0",""
"0","# --- Author"
"0","firstNames <- c()"
"0","lastNames <- c()"
"0","authorXPath <- ""//author"""
"0","author <- xpathSApply(root, authorXPath, xmlValue)"
"0","nauthor <- length(author)"
"0",""
"0","for (i in 1:nauthor) {"
"0","   splitAuthorName <- strsplit(author[i], ', ')"
"0","   firstNames <- c(firstNames, splitAuthorName[[1]][[2]])"
"0","   lastNames <- c(lastNames, splitAuthorName[[1]][[1]])"
"0","}"
"0",""
"0","firstNames <- unique(firstNames)"
"0","lastNames <- unique(lastNames)"
"0","noOfUniqueAuthors <- length(firstNames)"
"0",""
"0","authorDf <- data.frame (author_id =  integer(noOfUniqueAuthors),"
"0","                         fname = character(noOfUniqueAuthors),"
"0","                         lname = character(noOfUniqueAuthors),"
"0","                         stringsAsFactors = F)"
"0",""
"0","authorDf$author_id <- 1:noOfUniqueAuthors"
"0","authorDf$fname = firstNames"
"0","authorDf$lname = lastNames"
"0","# --- Author"
"0",""
"0",""
"0","# --- Genre"
"0","genre = c()"
"0","authorXPath <- ""//genre"""
"0","genres <- xpathSApply(root, authorXPath, xmlValue)"
"0","ngenres <- length(genres)"
"0",""
"0","for (i in 1:ngenres) {"
"0","   genre <- c(genre, genres[i])"
"0","}"
"0",""
"0","genre <- unique(genre)"
"0","noOfUniqueGenres <- length(genre)"
"0",""
"0","genreDf <- data.frame (genre_id =  integer(noOfUniqueGenres),"
"0","                         name = character(noOfUniqueGenres),"
"0","                         stringsAsFactors = F)"
"0",""
"0","genreDf$genre_id <- 1:noOfUniqueGenres"
"0","genreDf$name = genre"
"0","# --- Genre"
"0",""
"0","# --- Book"
"0","bookDf <- data.frame (book_id =  integer(sizeOfXML),"
"0","                         title = character(sizeOfXML),"
"0","                      price = double(sizeOfXML),"
"0","                      publish_date = character(sizeOfXML),"
"0","                      description = character(sizeOfXML),"
"0","                      genre_id = integer(sizeOfXML),"
"0","                         stringsAsFactors = F)"
"0",""
"0",""
"0","bookIds = c()"
"0","authorIds = c()"
"0","populateAuthors <- function(bookId, authors, bookIds, authorIds) {"
"0","  nAuthors = length(authors)"
"0","  for (i in 1:nAuthors) {"
"0","    bookIds <- c(bookIds, bookId)"
"0","    splitAuthorName <- strsplit(authors[i], "", "")[[1]]"
"0","    locatedAuthor <- which(authorDf$fname == splitAuthorName[2] & authorDf$lname == splitAuthorName[1])"
"0","    authorIds <- c(authorIds, locatedAuthor)"
"0","  }"
"0","  "
"0","  return(list(bookIds = bookIds, authorIds = authorIds))"
"0","}"
"0",""
"0","for (i in 1:sizeOfXML) {"
"0","  bid <- xmlAttrs(root[[i]])"
"0","  commonXpath = sprintf(""/catalog/book[@id='%s']/"", bid)"
"0","  bookDf$book_id[i] <- bid"
"0","  "
"0","  authorXPath <- paste0(commonXpath, 'author')"
"0","  authors <- xpathSApply(root[[i]], authorXPath, xmlValue)"
"0","  result <- populateAuthors(bid, authors, bookIds, authorIds)"
"0","  bookIds <- result$bookIds"
"0","  authorIds <- result$authorIds"
"0","  "
"0","  titleXPath = paste0(commonXpath, 'title')"
"0","  title = xpathSApply(root[[i]], titleXPath, xmlValue)"
"0","  bookDf$title[i] <- title"
"0","  "
"0","  genreXpath = paste0(commonXpath, 'genre')"
"0","  genre = xpathSApply(root[[i]], genreXpath, xmlValue)"
"0","  bookDf$genre_id[i] <- which(genreDf$name == genre)"
"0","  "
"0",""
"0","  priceXPath = paste0(commonXpath, 'price')"
"0","  price = xpathSApply(root[[i]], priceXPath, xmlValue)"
"0","  bookDf$price[i] <- as.double(price)"
"0","  "
"0","  pDateXPath = paste0(commonXpath, 'publish_date')"
"0","  pDate = xpathSApply(root[[i]], pDateXPath, xmlValue)"
"0","  bookDf$publish_date[i] <- pDate"
"0","  "
"0","  editionXPath = paste0(commonXpath, 'edition')"
"0","  edition = xpathSApply(root[[i]], editionXPath, xmlValue)"
"0","  print(edition)"
"0","  "
"0","  descriptionXPath = paste0(commonXpath, 'description')"
"0","  description = xpathSApply(root[[i]], descriptionXPath, xmlValue)"
"0","  bookDf$description[i] <- description"
"0","}"
"1","list()
"
"1","list()
"
"1","list()
"
"1","list()
"
"1","list()
"
"1","list()
"
"1","list()
"
"1","list()
"
"1","list()
"
"1","list()
"
"1","list()
"
"1","list()
"
"1","list()
"
"1","[1]"
"1"," ""2"""
"1","
"
"1","list()
"
"1","list()
"
"1","list()
"
"0","nAuthorIds <- length(authorIds)"
"0","# --- Book"
"0",""
"0","# --- Book_Author_Junction"
"0","bookAuthorJnDf <- data.frame (ab_jn_id =  integer(nAuthorIds),"
"0","                         book_id = integer(nAuthorIds),"
"0","                      author_id = integer(nAuthorIds),"
"0","                         stringsAsFactors = F)"
"0","bookAuthorJnDf$book_id <- bookIds"
"0","bookAuthorJnDf$author_id <- authorIds"
"0","bookAuthorJnDf$ab_jn_id <- 1:nAuthorIds"
"0","# --- Book_Author_Junction"
